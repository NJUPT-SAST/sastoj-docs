# 同步缓存

在比赛的过程中，我们所有的请求都是打到网关服务器上面，且所有 Get 请求都应该命中它的 Cache。为了达成这一目的，我们需要进行缓存的同步。这是一个简化的 “边缘存储” 的结构，Gateway 除了需要同步比赛信息，还需要主动或者被动地获取特定提交的回传。就目前而言，我们不打算让网关之间直接相互通讯。同时，由于 Gateway 部署在 Windows PC 上面，所以我们无法使用例如 `Redis` 一类的内存数据库，而只能使用 `localcache`。

## 启动服务前

这需要我们在启动服务之前，我们需要在 `user/contest` 服务中注册并从后端服务器同步当天的所有 `contest` 数据，以及它们所有的 `problem` 数据。

## 比赛开始后

在比赛开始后，我们会涉及到 `submission`, `submissionCase`, `rank` 等数据的变更

## 提交 & 测试点

这是在用户发起提交请求之后得到的数据，由于评测需要时间，这个部分去程使用 mq、回程使用grpc，以确保不会发生数据丢失，也保证了用户使用体验。

## 排名

Rank 信息是在后端完成计算，由 Gateway 拉取信息。

## 比赛 / 题目的信息更新（future）

如果后端对部分信息进行了更新，我们也需要同步这些数据，以保证缓存的一致性。
